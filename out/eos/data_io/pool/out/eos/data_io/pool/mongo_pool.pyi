from typing import Optional, Union

import pandas as pd
from _typeshed import Incomplete as Incomplete
from bson.codec_options import CodecOptions as CodecOptions
from pymongo import MongoClient as MongoClient
from pymongo.collection import Collection as Collection
from pymongo.database import Database as Database

from eos.data_io.config import DBConfig as DBConfig
from eos.data_io.pool import Pool as Pool
from eos.data_io.struct import DataFrameDoc as DataFrameDoc
from eos.data_io.struct import ObservationMeta as ObservationMeta
from eos.data_io.struct import PoolQuery as PoolQuery

class MongoPool(Pool[pd.DataFrame]):
    client: MongoClient
    db: Database
    coll_name: str
    collection: Collection[DataFrameDoc]
    meta: ObservationMeta
    db_config: DBConfig
    query: PoolQuery
    codec_option: CodecOptions
    logger: Incomplete
    dictLogger: Incomplete
    def __post_init__(self) -> None: ...
    def load(self) -> None: ...
    def close(self) -> None: ...
    def drop_collection(self) -> None: ...
    def parse_query(self, query: Union[PoolQuery | PoolQuery]) -> dict: ...
    def store_record(self, episode: pd.DataFrame): ...
    def store_episode(self, episode: pd.DataFrame): ...
    def store(self, episode: pd.DataFrame): ...
    def find(self, query: Union[PoolQuery | PoolQuery]) -> Optional[pd.DataFrame]: ...
    def delete(self, item_id) -> None: ...
    def __iter__(self): ...
    def count(self, query: Optional[PoolQuery | PoolQuery] = ...): ...
    def sample(self, size: int = ..., *, query: Optional[PoolQuery] = ...) -> pd.DataFrame: ...
    def __init__(self, *, client, db, coll_name, collection, meta, db_config, query, codec_option) -> None: ...
